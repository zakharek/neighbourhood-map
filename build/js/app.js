function PlaceService(){var e={},n=document.createElement("div"),t=new google.maps.Map(n),o=new google.maps.places.PlacesService(t);return e.getPlaces=function(e,n,t,r,a){var i={location:new google.maps.LatLng(e,n),radius:t.toString(),query:r};o.textSearch(i,a)},e}function YelpService(){var e={},n="http://api.yelp.com/v2/search",t=5e3,o={consumerKey:"vu0qenpVl7V11Ju6vp1RNg",consumerSecret:"T6Z4hRRL3gkuH9gQeHUhhS2bBt4",accessToken:"4qWApiXXt6QtM6h62EaybnZr_m_REmqK",accessTokenSecret:"7eCB-eCrTr2uvFied_RXAIp5VtQ",serviceProvider:{signatureMethod:"HMAC-SHA1"}},r={consumerSecret:o.consumerSecret,tokenSecret:o.accessTokenSecret},a=function(e){e.push(["callback","cb"]),e.push(["oauth_consumer_key",o.consumerKey]),e.push(["oauth_consumer_secret",o.consumerSecret]),e.push(["oauth_token",o.accessToken]),e.push(["oauth_signature_method","HMAC-SHA1"])};return e.search=function(e,o,i,u){var c=function(){var t=[];t.push(["term",e]),t.push(["cc",i]),t.push(["category_filter",u]),t.push(["location",o]),a(t);var c={action:n,method:"GET",parameters:t};return OAuth.setTimestampAndNonce(c),OAuth.SignatureMethod.sign(c,r),OAuth.getParameterMap(c.parameters)},s=$.Deferred(),l=setTimeout(function(){s.reject("Yelp search request timed out after "+t/1e3+" seconds")},t);return $.ajax({url:n,data:c(),dataType:"jsonp",jsonpCallback:"cb",cache:!0,success:function(e,n,t){window.clearTimeout(l),s.resolve(e,n,t)}}),s.promise()},e}ko.renderTemplateX=function(e,n){var t=$("<div>");ko.applyBindingsToNode(t[0],{template:{name:e,data:n||{}}});var o=t.html();return t.remove(),o},ko.bindingHandlers.map=function(){var e,n,t,o,r,a,i={},u=[],c=[],s=[],l=14,d=20,p=function(){for(var e=0;e<u.length;e++)u[e].setMap(null);u=[]},m=function(e){for(var n=0;n<u.length;n++)e!==u[n]&&u[n].setAnimation(null);f(e)||e.setAnimation(a)},f=function(e){return e.getAnimation()===a},g=function(e){return t.getBounds().contains(e.getPosition())},h=function(){return u.filter(function(e){return g(e)}).length===u.length},v=function(){t.setOptions({maxZoom:l}),t.fitBounds(n),t.setOptions({maxZoom:d})},k=function(n,a){e&&e.close(),e=new google.maps.InfoWindow({content:r}),e.open(t,n),o(a,function(n){e.setContent(n)})},b=function(e,n){for(var t=0;t<n.length;t++)e!==n[t]&&n[t].selected(!1);e.selected(!0)},w=function(e){var n=c.indexOf(e);if(-1!==n){var t=s[n];t&&t.dispose()}},S=function(e,n){-1===c.indexOf(e)&&c.push(e);var t=c.indexOf(e);s[t]=n},y=function(e,n){return function(){b(e,n)}},M=function(e,n,t){return function(o){o&&(b(n,t),k(e,n),m(e)),h()||v()}},A=function(e){if(p(),e.length){n=new google.maps.LatLngBounds;for(var o=0;o<e.length;o++){var r=new google.maps.Marker({position:new google.maps.LatLng(e[o].latitude,e[o].longitude),animation:google.maps.Animation.DROP,draggable:!1,map:t});r.addListener("click",y(e[o],e)),w(e[o]);var a=e[o].selected.subscribe(M(r,e[o],e));S(e[o],a),u.push(r),n.extend(r.position)}v()}};return i.init=function(e,n){var i=n(),u=ko.unwrap(i.markers),c=ko.unwrap(i.lat),s=ko.unwrap(i.lng);a=google.maps.Animation.BOUNCE,o=ko.unwrap(i.getInfoWindowContent),r=ko.unwrap(i.defaultContent),t=new google.maps.Map(e,{center:{lat:c,lng:s},zoom:l}),A(u)},i.update=function(e,n){var t=n(),o=t.markers();A(o)},i}(),ko.bindingHandlers.media=function(){var e={};return e.init=function(e,n){var t=n(),o=t.query,r=window.matchMedia(o);r.addListener(function(){t.changed(r.matches)}),t.changed(r.matches)},e}();var googleMapError=function(){$(".google-maps-load-error").show()},initMap=function(){var e=-33.862856,n=151.210482,t=3e4,o="dental clinic",r="AU",a="Sydney",i="health",u=function(e){return{name:e.name,latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng(),selected:ko.observable(!1)}},c=function(e,n,t,o){var c={},s=YelpService(),l=function(e){for(var n=0;n<e.length;n++)e[n].selected(!1)},d=function(){return ko.utils.arrayFilter(c.places(),function(e){return-1!==e.name.toLowerCase().indexOf(c.currentFilter().toLowerCase())})},p=function(e,n){return e.slice().sort(function(e,t){var o=Math.abs(e.location.coordinate.latitude-n.latitude)+Math.abs(e.location.coordinate.longitude-n.longitude),r=Math.abs(t.location.coordinate.latitude-n.latitude)+Math.abs(t.location.coordinate.longitude-n.longitude);return o-r})[0]},m=function(e,n){var t="n/a",o=e&&e.businesses.length?p(e.businesses,n).display_phone||t:t;return ko.renderTemplateX("placeInfo",{name:n.name,phone:o})};c.placeSearchFailed=o,c.mapCentreLatitude=e,c.mapCentrelongitude=n,c.places=ko.observableArray(t.map(u)),c.currentFilter=ko.observable(""),c.filter=ko.observable(""),c.isDesktop=ko.observable(!1),c.menuHidden=ko.observable(!o),c.defaultContent=ko.renderTemplateX("defaultInfo"),c.filteredPlaces=ko.computed(function(){return c.currentFilter()?d():c.places()}),c.menuShown=ko.computed(function(){return!c.menuHidden()}),c.doFilter=function(){c.currentFilter(c.filter()),l(c.filteredPlaces()),c.currentFilter.valueHasMutated()},c.selectPlace=function(e){var n=c.filteredPlaces().filter(function(n){return n!=e});l(n),e.selected(!0),c.isDesktop()||c.menuHidden(!0)};var f=!1;return c.layoutChanged=function(e){return!f&&o?(c.menuHidden(!1),void(f=!0)):(c.isDesktop(e),e?void c.menuHidden(!1):void c.menuHidden(!0))},c.toggleSideMenu=function(){var e=c.menuHidden();c.menuHidden(!e)},c.getInfoWindowContent=function(e,n){s.search(e.name,a,r,i).done(function(t){var o=m(t,e);n(o)}).fail(function(e){var t=ko.renderTemplateX("getPlaceError",{error:e});n(t)})},c},s=PlaceService();s.getPlaces(e,n,t,o,function(t,o){var r=o!==google.maps.places.PlacesServiceStatus.OK,a=c(e,n,t,r);ko.applyBindings(a)})};